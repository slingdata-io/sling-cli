# ADBC PostgreSQL Test
# This test requires:
# 1. Install dbc CLI: curl -sS https://dbc.columnar.tech/install.sh | bash
# 2. Install PostgreSQL driver: dbc install postgresql
# 3. Set ADBC_POSTGRES connection in env.yaml with:
#    type: adbc
#    driver_name: postgresql
#    adbc.postgresql.connection_string: postgresql://user:pass@host:5432/db

source: ADBC_POSTGRES
target: LOCAL

defaults:
  mode: full-refresh
  target_options:
    format: csv

hooks:
  start:
    - type: log
      message: "Testing ADBC PostgreSQL connection"

  end:
    - type: check
      check: execution.status.error == 0
      on_failure: break

    - type: read
      into: result
      from: file:///tmp/adbc_test_output.csv

    - type: log
      message: "Read CSV data: {store.result}"

    - type: check
      check: contains(store.result, "1,test")
      message: "Expected CSV to contain '1,test'"

    - type: log
      message: "ADBC test completed successfully"

streams:
  "select 1 as id, 'test' as name":
    object: file:///tmp/adbc_test_output.csv
