steps:
  # Setup: write a test CSV to S3
  - type: write
    to: aws_s3/test/temp_issue705/test.csv
    content: |
      id,name,value
      1,alpha,100
      2,beta,200
      3,gamma,300

  # Run inline replication using sql (DuckDB read_csv path)
  - replication:
      source: aws_s3
      target: local
      defaults:
        mode: full-refresh
      streams:
        test/temp_issue705/test.csv:
          object: file://temp/issue705/output.csv
          sql: "select * from {stream_scanner} limit 10"

  # Cleanup
  - type: delete
    location: aws_s3/test/temp_issue705/
    recursive: true

  - type: delete
    location: local/temp/issue705/
    recursive: true
